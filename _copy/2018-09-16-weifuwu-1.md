---
layout:       post
title:        "单体、服务化架构一点概念"
subtitle:     "浅析单体架构和服务化架构的一些概念"
date:         2018-09-15 22:42:05
author:       "Hyuga"
header-img:   "img/2018/2018-09/head-top-4.jpg"
header-mask:  0.3
catalog:      true
multilingual: false
tags:
    - 架构
---

http://www.jeegem.com/pricingCore

https://blog.csdn.net/world6/article/details/79114105

https://blog.csdn.net/qq_37788067/article/details/79250623

## 概念
- 单机：
    - 一个人(买菜洗菜做饭洗碗)[整体事件]
    - 一台服务器部署一个项目
    - 结构简单，高风险，一宕机就完了
- 集群：
    - 多个人(买菜洗菜做饭洗碗)[整体事件]
    - 多台服务器部署同一个项目
    - 通过负载均衡设备共同对外提供服务，解决了单机宕机的风险，同时采用空间换时间，多台服务能更快处理更多请求
- 分布式(分散压力)：
    - 一个(买菜)一个(洗菜)一个(做饭)一个(洗碗)[单体事件]
    - 一个项目中不同模块拆分成多个项目，部署到不同服务器
    - 解决了网站高并发带来的问题，不同的业务请求分割到不同服务，避免所有业务请求都在某一个系统中处理
- SOA(ESB企业服务总线)：
    - 业务系统分解为多个组件，让每个组件都独立提供离散，自治，可复用的服务能力
    - 通过服务的组合和编排来实现上层的业务流程
    - 简化维护，降低整体风险，伸缩灵活
- 微服务(分散能力)：
    - 分布式概念比较广，微服务架构其实就是分布式服务架构的子集
    -

## 单机机构
> 一个项目包含了所有业务模块，部署到一台服务器上。

优点：
- 易于开发、测试、部署
- 成本低，一台服务器即可
缺点：
- 单机处理能力有限，业务量到了一定程度，单机硬件资源撑不住业务需求
- 业务模块间通过方法调用，代码耦合度高
- 如果一个功能模块突然访问量过大，可能影响整个系统的性能
- 改动任何一个模块的功能，
- 宕机风险高

## 集群
> 单机处理到达瓶颈，将单机上的项目copy部署到其他的几台服务器上，这就是`集群`。每一台服务器就是该集群的一个`节点`，每个`节点`提供的服务都是一样的。
>
> 集群是需要配合负载均衡服务器一起使用的，负载均衡服务器作用在于按每个`节点`的负载情况分配用户请求，以达到每个`节点`负载平衡。

优点：
- 系统处理能力提升
- 避免单机宕机风险
- 系统拓展很容易，加一台服务器copy项目部署即可，最多也就配置下负载均衡配置
缺点:
- 代码耦合度还是高
- 当业务发展到一定程度，在怎么增加节点整个集群性能提升也不明显，这个时候考虑下分布式架构

## 分布式
> 集群对项目代码是近乎无改动的，只需要copy部署多几台服务器就好了。但分布式则不同，需要将原有项目按功能或者模块等进行拆分，拆分成多个独立的子系统，每个子系统能独立运行在服务器上，通过RPC方式通信。
>
> 分布式一般会有一个注册中心的概念，比如zookeeper等，用于各系统间对外的服务注册，便于各系统通过接口模式通信。

优点：
- 系统间耦合度大大降低，可独立开发、部署、测试
- 系统间边界明确，排错相对容易，开发效率也会提高很多
- 系统便于扩展，比如某个服务业务量大了，可以只针对这个服务增加集群节点
- 服务复用性更高，分布式系统对外提供服务，其他系统都可以使用，不需要重复开发

缺点：
- 运维更复杂
- 投入成本更多，人员、服务器、研发周期等
- 项目相对原来的单项目模式显得更为庞大复杂

## 微服务
> 其实微服务的意思也是将模块拆分成一个个独立的服务单元通过接口来实现数据交互，也是属于分布式的一种，



---
**集群和分布式的区别**
- 集群：一个项目多台服务器
    - 物理形态：copy项目，加机器部署
    - 分担客户端请求压力
- 分布式：一个项目拆分多个业务模块，部署多台服务器上
    - 工作方式：拆分项目，每个模块部署到新的服务器上



集群一般采用的是负载均衡集群，也就是nginx集群，服务请求经过nginx服务器判断那台系统服务器的负载不重，就将请求分发到那一台去完成。
```
nginx集群是指：采用nginx服务器来做负载均衡集群，nginx服务器可以是一台，也可能是多台集群。
```
单纯的分布式和集群是不一样的，集群服务挂了一台，其他的服务器一样可以用，只是服务器压力会变大，但不会直接停服。而单纯的分布式是指一个项目多模块拆分成多个模块系统，每个模块系统部署到新的一台服务器上，形成分布式架构。

那么问题来了，只有一个节点的模块系统，一旦节点垮了，这个业务就不可调用了。所以就有新的组合玩法：`分布式集群`

`分布式集群`：单机项目拆分成分布式后，分布式架构的某一个模块系统也可以采用集群架构，也就是所谓的分布式集群。

其实分布式和集群就是概念性的东西，集群就是copy，分布式就是拆分，可以单纯的copy，也可以拆分后再copy.

举个简单的例子：
单机：一个电商项目部署在一台服务器上
集群：一个电商项目部署在多台服务器上，通过nginx等技术做负载均衡集群
分布式：一个电商项目多个模块拆分成多个系统，比如支付系统，用户系统，商品系统，订单系统等等，每个系统都部署到对应的新服务器上，这就是分布式
分布式集群：一个整体项目分布式拆分后，每个模块系统再采用集群方式架构

<h5>集群是通过提高单位时间内执行的任务数来提升效率，而分布式是以缩短单个任务的执行时间来提升效率。</h5>
栗子：
假如一台服务器1s能处理1个请求，那么100个请求就需要100s，但如果是100台服务器集群，则理论上集群1s可以处理完这100个请求。
假如一台服务器处理一个业务请求，分10步，每部









## 架构演变

单体 —> 服务化 ->

怎么实施微服务：
框架：注册中心，负载均衡，声明式服务调用，容错，网关，配置
拆分：业务模块拆分成一个个独立的项目，循序渐进，不要想着一步到位，小项目不建议，老项目多考虑





单体缺点：
- 耦合性高
- 部署耗时长
- 稳定性差
- 扩展性差

服务化：
单体系统多模块拆分成多个服务系统，多个服务系统之间通信是将服务接口暴露注册到注册中心，使用同一协议，



微服务架构的优点：
边界清晰，开发测试维护简单：每个服务职责清晰
技术栈灵活：每个服务开发语言可不同，只需要把服务注册到注册中心，统一协议
松耦合：各个服务间不像单体架构一样通过方法调用
可用性：单个服务宕机，不影响其他服务访问，可能影响业务，如果有关联
按需扩展：某个服务需要做硬件升级，比如集群，硬件升级等，不影响其他服务

微服务的缺点：
接口依赖：
分布式带来的复杂性：网络延迟、容错、消息序列化、数据一致性、


单体服务升级微服务的问题：
服务寻址问题：单个服务不可能记录下所有要调用的服务的ip集，所以需要用到注册中心
服务调用方式问题：http、dubbo
服务负载均衡问题：
    集群：调用者->nginx->提供者（基于服务端的负载均衡，请求发出后）
    dubbo、cloud：调用者去注册中心拿要调用的ip，然后再去调用相应ip的服务（基于客户端的负载均衡，请求发出前）
服务调用容错问题：
    服务熔断与降级、线程隔离Hystrix

声明式服务调用：Feign   ribbon
权限



## 集群分布式

微服务一定是分布式


框架：springBoot + mybatis + mysql
前端：bootstrap angularJs
消息中间件：rabbitmq
缓存：redis


SpringBoot和SpringCloud
SpringBoot基于Spring，整合了Spring，SpringCloud基于SpringBoot

SpringCloud是Spring家族的一员，用于快速构建分布式应用
